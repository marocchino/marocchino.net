<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>A study note</title>

  
  <meta name="author" content="marocchino">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="A study note"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="A study note" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">A study note</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2021/04/17/install-bitwarden-to-rpi/"><span>BitWarden(rs)를 라즈베리파이에 설치하기</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/04/17/install-bitwarden-to-rpi/" rel="bookmark">
        <time class="entry-date published" datetime="2021-04-17T03:25:40.000Z">
          2021-04-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1>과정</h1>
<h2 id="subdomain-ipv6으로-설정">subdomain ipv6으로 설정</h2>
<p>젤 오래걸리니 젤 먼저하는 걸 추천 v4는 A고 v6는 AAAA인것만 기억하면 어려울것 없다.<br>
주소는 ifconfig로 확인가능. (아마 없을테니까 apt로 깔자)</p>
<h2 id="Docker">Docker</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker docker-compose</span><br><span class="line">sudo adduser bitwarden</span><br><span class="line">sudo groupadd docker</span><br><span class="line">sudo usermod -aG docker bitwarden</span><br></pre></td></tr></table></figure>
<h2 id="Let’s-Encrypt">Let’s Encrypt</h2>
<p>난 여기서 파일 권한 문제로 삽질 많이했는데 그냥 bitwarden계정으로 도커를<br>
실행하면 알아서 퍼미션 잡힐테니 그냥 이렇게 하면 된다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo su - bitwarden</span><br><span class="line">docker run -it --rm --name certbot \</span><br><span class="line">  -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">  -v <span class="string">&quot;/var/lib/letsencrypt:/var/lib/letsencrypt&quot;</span> \</span><br><span class="line">  certbot/certbot:arm64v8-latest certonly \</span><br><span class="line">  --standalone -d <span class="variable">$YOUR_DOMAIN_HERE</span> -m <span class="variable">$YOUR_EMAIL_HERE</span> --agree-tos</span><br></pre></td></tr></table></figure>
<h2 id="서버-띄우기">서버 띄우기</h2>
<p><code>start.sh</code>파일을 만들어두자.<br>
로그볼일이 있을까 싶어서 일부러 <code>--rm</code>옵션은 주지 않았다.<br>
ROCKET_ADDRESS는 디폴트가 0.0.0.0이라 그대로두면 IPv4에서 밖에 인식 못하니 주의</p>
<!-- markdownlint-disable MD013 -->
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">yes | docker container prune <span class="comment"># prune이 싫으면 docker rm bitwarden 해도 된다</span></span><br><span class="line">docker run -d --name bitwarden \</span><br><span class="line">  -e ROCKET_TLS=<span class="string">&quot;&#123;certs=\&quot;/letsencrypt/live/<span class="variable">$YOUR_DOMAIN_HERE</span>/fullchain.pem\&quot;,key=\&quot;/letsencrypt/live/<span class="variable">$YOUR_DOMAIN_HERE</span>/privkey.pem\&quot;&#125;&quot;</span> \</span><br><span class="line">  -e ROCKET_ADDRESS=<span class="string">&#x27;::&#x27;</span> \</span><br><span class="line">  -e ADMIN_TOKEN=<span class="string">&quot;<span class="variable">$ADMON_TOKEN</span>&quot;</span> \</span><br><span class="line">  --hostname your.servername.here \</span><br><span class="line">  -v /etc/letsencrypt/:/letsencrypt/ \</span><br><span class="line">  -v /home/bitwarden/bwdata/:/data/ \</span><br><span class="line">  -p 443:80 \</span><br><span class="line">  vaultwarden/server:latest</span><br></pre></td></tr></table></figure>
<!-- markdownlint-enable MD013 -->
<h2 id="인증서-자동-갱신">인증서 자동 갱신</h2>
<p><code>renew.sh</code>파일도 만들자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">yes | docker container prune</span><br><span class="line">docker run -it --name certbot \</span><br><span class="line">  -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">  -v <span class="string">&quot;/var/lib/letsencrypt:/var/lib/letsencrypt&quot;</span> \</span><br><span class="line">  certbot/certbot:arm64v8-latest renew</span><br></pre></td></tr></table></figure>
<p>매월 15일에 갱신하고 내친김에 리붓했을때 서버 자동으로 켜게 해두자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crontab -u bitwarden -e</span><br><span class="line">00 04 15 * * /home/bitwarden/renew.sh</span><br><span class="line">@reboot /home/bitwarden/start.sh</span><br></pre></td></tr></table></figure>
<h2 id="IPv6-IP-고정">IPv6 IP 고정</h2>
<p>라즈비안에서는 그런 일없었는데 리붓할때 마다 아이피가 바뀐다.</p>
<p>Network -&gt; Wired -&gt; Config -&gt; IPv6가서 다음 과 같이 설정한다.<br>
v6 IP는 대충 <code>2409:10:12:34:56:78:90:12</code>라고 가정해보자.</p>
<p>Method: Manual<br>
Address: 2409:10:12:34:56:78:90:12<br>
Prefix: 2409:10:12:34::/64<br>
Gateway: 2409:10:12:34::1</p>
<p>리붓하면 아이피가 고정된다.</p>
<h2 id="Todo">Todo</h2>
<p>갱신이 7월 16일이니 그때 갱신 됐는지 확인하면 될듯.</p>
<h2 id="이력">이력</h2>
<ul>
<li>2021.05.22 IP 고정항목 추가, bitwardenrs -&gt; vaultwarden, ROCKET_ADDRESS 추가</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/02/23/contribute-to-brew/"><span>brew에 기여하기</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/02/23/contribute-to-brew/" rel="bookmark">
        <time class="entry-date published" datetime="2021-02-22T22:49:02.000Z">
          2021-02-23
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="동기">동기</h2>
<p>굉장히 드물게 homebrew에 최신버전이 없는걸 내가 젤 먼저 눈치챌 때가 있다.<br>
새버전 나올때 까지 기다리는 것도 방법이긴 한데 의외로 기여하는 방법이 어렵지<br>
않으니 어떻게 해야하는지 알고 있다면 직접 할 수도 있다.</p>
<p>덧붙이자면 이런 류의 기여는 재미있어서 한다기 보다는 내가 시간이 있고 마침<br>
손이 비니까 하는 환경 미화 같은 것이다.</p>
<h2 id="발견">발견</h2>
<p>내 경우는 배포처에서 새버전을 만들면서 기존 버전을 지워서 눈치챌 수 있었다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">❯ brew install texshop</span><br><span class="line">==&gt; Downloading https://pages.uoregon.edu/koch/texshop/texshop-64/texshop458.zip</span><br><span class="line">-<span class="comment">#O#- #   #</span></span><br><span class="line">curl: (22) The requested URL returned error: 404 Not Found</span><br><span class="line">Error: Download failed on Cask <span class="string">&#x27;texshop&#x27;</span> with message: Download failed: https://pages.uoregon.edu/koch/texshop/texshop-64/texshop458.zip</span><br></pre></td></tr></table></figure>
<h2 id="한일">한일</h2>
<p>먼저 edit로 해당 탭을 열어 버전만 수정해서 인스톨 해본다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">❯ brew edit texshop</span><br><span class="line">Editing /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-cask/Casks/texshop.rb</span><br><span class="line">❯ brew install texshop</span><br><span class="line">==&gt; Downloading https://pages.uoregon.edu/koch/texshop/texshop-64/texshop459.zip</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">Error: SHA256 mismatch</span><br><span class="line">Expected: 97ccf1ebfbb30b8557c972ee2a207a4b570057ae127b9b93cfada73ffbdc907e</span><br><span class="line">  Actual: 5c018481244098c0d622f9b976cd0af1f923c7a9e80ab6fe3969ad4b338334fa</span><br><span class="line">    File: /Users/marocchino/Library/Caches/Homebrew/downloads/03b3398e2bc593405fc7eeaa245c15cf0e9cfbf0a8882b5d0e6d7e2ac9b08c5e--texshop459.zip</span><br><span class="line">To retry an incomplete download, remove the file above.</span><br></pre></td></tr></table></figure>
<p>sha가 다르다고 통과시켜주지 않으니 저것도 고쳐주자.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">~ took 1m41s ❯ brew edit texshop</span><br><span class="line">Editing /usr/<span class="built_in">local</span>/Homebrew/Library/Taps/homebrew/homebrew-cask/Casks/texshop.rb</span><br><span class="line">~ took 10s ❯ brew install texshop</span><br><span class="line">Updating Homebrew...</span><br><span class="line">==&gt; Auto-updated Homebrew!</span><br><span class="line">Updated 2 taps (homebrew/core and homebrew/cask).</span><br><span class="line">==&gt; Updated Formulae</span><br><span class="line">Updated 1 formula.</span><br><span class="line">==&gt; Updated Casks</span><br><span class="line">Updated 2 casks.</span><br><span class="line"></span><br><span class="line">==&gt; Downloading https://pages.uoregon.edu/koch/texshop/texshop-64/texshop459.zip</span><br><span class="line">Already downloaded: /Users/marocchino/Library/Caches/Homebrew/downloads/03b3398e2bc593405fc7eeaa245c15cf0e9cfbf0a8882b5d0e6d7e2ac9b08c5e--texshop459.zip</span><br><span class="line">==&gt; Installing Cask texshop</span><br><span class="line">==&gt; Moving App <span class="string">&#x27;TeXShop.app&#x27;</span> to <span class="string">&#x27;/Applications/TeXShop.app&#x27;</span></span><br><span class="line">🍺  texshop was successfully installed!</span><br></pre></td></tr></table></figure>
<p>설치 해서 문제없이 프로그램이 열리는 걸 확인했으면 이제 방금 수정한 내용으로<br>
<a target="_blank" rel="noopener" href="https://github.com/Homebrew/homebrew-cask/pull/100249">PR</a>을 던진다.</p>
<p>탬플릿을 볼 수 있는데 밑에 새캐스크 만드는 법을 무시하면 내가해야할 일을 3가지<br>
이다.</p>
<blockquote>
<p><strong>Important:</strong> <em>Do not tick a checkbox if you haven’t performed its action.</em><br>
Honesty is indispensable for a smooth review process.</p>
<p>After making all changes to a cask, verify:</p>
<ul>
<li>[ ] The submission is for<br>
<a target="_blank" rel="noopener" href="https://github.com/Homebrew/homebrew-cask/blob/master/doc/development/adding_a_cask.md#stable-versions">a stable version</a><br>
or<br>
<a target="_blank" rel="noopener" href="https://github.com/Homebrew/homebrew-cask/blob/master/doc/development/adding_a_cask.md#but-there-is-no-stable-version">documented exception</a>.</li>
<li>[ ] <code>brew audit --cask &#123;&#123;cask_file&#125;&#125;</code> is error-free.</li>
<li>[ ] <code>brew style --fix &#123;&#123;cask_file&#125;&#125;</code> reports no offenses.</li>
</ul>
</blockquote>
<p>시키는 대로 하자.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">❯ brew audit --cask texshop</span><br><span class="line">==&gt; Installing <span class="string">&#x27;bundler&#x27;</span> gem</span><br><span class="line">... 생략 ...</span><br><span class="line">Bundle complete! 30 Gemfile dependencies, 82 gems now installed.</span><br><span class="line">Bundled gems are installed into `../../usr/<span class="built_in">local</span>/Homebrew/Library/Homebrew/vendor/bundle`</span><br><span class="line">Post-install message from sorbet:</span><br><span class="line"></span><br><span class="line">  Thanks <span class="keyword">for</span> installing Sorbet! To use it <span class="keyword">in</span> your project, first run:</span><br><span class="line"></span><br><span class="line">    bundle <span class="built_in">exec</span> srb init</span><br><span class="line"></span><br><span class="line">  <span class="built_in">which</span> will get your project ready to use with Sorbet.</span><br><span class="line">  After that whenever you want to typecheck your code, run:</span><br><span class="line"></span><br><span class="line">    bundle <span class="built_in">exec</span> srb tc</span><br><span class="line"></span><br><span class="line">  For more docs see: https://sorbet.org/docs/adopting</span><br><span class="line">audit <span class="keyword">for</span> texshop: passed</span><br><span class="line">❯ brew style --fix texshop</span><br><span class="line"></span><br><span class="line">1 file inspected, no offenses detected</span><br></pre></td></tr></table></figure>
<p>CI가 돌고 문제가 없으면 바로 머지된다. (8분 밖에 걸리지 않았다!)</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/macos/">macos</a><a href="/tags/homebrew/">homebrew</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/20/blog-recovery/"><span>Blog Recovery</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/20/blog-recovery/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-20T03:38:27.000Z">
          2021-01-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>오랬동안 방치했더니 죽어있길레 짬짬히 시간내서 살림.</p>
<p>한 작업들은 다음과 같다.</p>
<ul>
<li>A record 변경: 예전에 설정했던 값이랑 바뀌어서 갱신 해줌 <a target="_blank" rel="noopener" href="https://docs.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-an-apex-domain">참고링크</a>
<ul>
<li>적용하고 반영되는데 반나절이상 걸려서 귀찮았다.</li>
</ul>
</li>
<li>publish 브랜치를 master에서 main으로 변경</li>
<li>레포이름을 <a target="_blank" rel="noopener" href="http://marocchino.github.com">marocchino.github.com</a> -&gt; marocchino.net으로 변경
<ul>
<li>이참에 dev도메인도 살까 싶음</li>
</ul>
</li>
<li>테마의 대상 레포 변경
<ul>
<li>hexo 테마를 포크해서 폰트만 바꿔서쓰고 있었는데, 시큐리티 업뎃이 귀찮아서<br>
대량으로 레포지우다 포크떠논 레포도 실수로 지워버렸다가 복구하면서 그냥<br>
업스트림 바라보게 변경</li>
</ul>
</li>
<li>hexo 메어져 업데이트
<ul>
<li>그냥 워닝만 고쳐주니 돌아감</li>
</ul>
</li>
<li>markdownlintrc -&gt; markdownlint.json
<ul>
<li>이것도 메이져 업데이트하면서 설정 파일이 바뀐듯</li>
</ul>
</li>
</ul>
<p>살렸으니 당분간 이것저것 삽질해봐야지</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/hexo/">hexo</a><a href="/tags/github-page/">github page</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/08/26/to-save-a-column-using-id/"><span>id를 사용하는 컬럼을 저장하려면</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/08/26/to-save-a-column-using-id/" rel="bookmark">
        <time class="entry-date published" datetime="2017-08-26T08:54:15.000Z">
          2017-08-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>에초에 이런 모델이있었다.</p>
<figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ApplicationRecord</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>url에 아이디 대신 상품 코드를 표시하고 싶다는 요구사항이 추가 되었다.
뭐 이정도야 껌이지.</p>
<figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ApplicationRecord</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">self</span>.<span class="title">find_by_code</span><span class="params">(code)</span></span></span><br><span class="line">    find(code.sub(<span class="regexp">/\AC0+/</span>, <span class="string">''</span>))</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">code</span></span></span><br><span class="line">    <span class="string">"C<span class="subst">#&#123;id.to_s.rjust(<span class="number">7</span>, <span class="string">'0'</span>)&#125;</span>"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>코드를 커스터마이징 하고싶다는 요구사항이 추가되었다.
DB에 저장해야하는데 <code>before_create</code> 시점에서는 모델의 아이디를 뽑을 수 없다.
저장을 두번 하는게 신경쓰이긴하지만 어쩔수 없지 <code>after_save</code> 인가.</p>
<figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ApplicationRecord</span></span><br><span class="line">  after_create <span class="symbol">:generate_code</span></span><br><span class="line"></span><br><span class="line">  private</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">generate_code</span></span></span><br><span class="line">    <span class="keyword">self</span>.code <span class="params">||</span>= <span class="string">"C<span class="subst">#&#123;id.to_s.rjust(<span class="number">7</span>, <span class="string">'0'</span>)&#125;</span>"</span></span><br><span class="line">    throw(<span class="symbol">:abort</span>) <span class="keyword">unless</span> save</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>테스트를 돌려보면 워닝이 대량 발생한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DEPRECATION WARNING: The behavior of attribute_changed? inside of after...</span><br><span class="line">.DEPRECATION WARNING: The behavior of attribute_changed? inside of after...</span><br><span class="line">.DEPRECATION WARNING: The behavior of attribute_changed? inside of after...</span><br><span class="line">.DEPRECATION WARNING: The behavior of attribute_changed? inside of after...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>으으.. 이건 <code>save</code>안에서 업데이트할 컬럼을 찾기위해 <code>attribute_changed?</code>를
부르기 때문이다.  성능에도 안좋고 좀 진지하게 검색해서 <code>before_create</code>로 옮기는
대신 아이디를 직접뽑는 방향으로 전환.</p>
<figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> &lt; ApplicationRecord</span></span><br><span class="line">  before_create <span class="symbol">:generate_id_and_code</span></span><br><span class="line"></span><br><span class="line">  private</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">generate_id_and_code</span></span></span><br><span class="line">    <span class="keyword">self</span>.id <span class="params">||</span>=</span><br><span class="line">      <span class="keyword">self</span><span class="class">.<span class="keyword">class</span>.<span class="title">connection</span></span></span><br><span class="line">      .select_value(<span class="string">"select nextval('<span class="subst">#&#123;<span class="keyword">self</span><span class="class">.<span class="keyword">class</span>.<span class="title">sequence_name</span>&#125;')")</span></span></span></span><br><span class="line"><span class="string"><span class="subst">    <span class="keyword">self</span>.code = <span class="string">"C<span class="subst">#&#123;id.to_s.rjust(<span class="number">7</span>, <span class="string">'0'</span>)&#125;</span>"</span> <span class="keyword">unless</span> code?</span></span></span><br><span class="line"><span class="string"><span class="subst">  <span class="keyword">end</span></span></span></span><br><span class="line"><span class="string"><span class="subst"><span class="keyword">end</span></span></span></span><br></pre></td></tr></table></figure>
<p>이제 저장도 한번하고 테스트돌려도 워닝안나온다.
만족</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/ruby/">ruby</a><a href="/tags/rails/">rails</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/01/20/tips-for-test/"><span>설계와 테스트</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/01/20/tips-for-test/" rel="bookmark">
        <time class="entry-date published" datetime="2017-01-19T20:23:33.000Z">
          2017-01-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1>도입</h1>
<p>tl;dr red - green - refactor</p>
<p>어디 보낼글 아니니 반말로 써야지.</p>
<p>테스트 안하는 사람들의 논리는 몇가지 패턴이 있다.</p>
<ul>
<li>바빠서 못해요.</li>
<li>나는 테스트에 가치를 발견하지 못하겠다.</li>
<li>테스트할 만한 가치가 없는 부분이에요.</li>
<li>변경이 너무 잦아서 의미가 없어요.</li>
</ul>
<p>위에 있는 경우는 뭐 설득당할 생각이 없거나 여유가 없는거라 어쩔 수 없는데 오늘<br>
설득 가능할 것 같은 새 패턴을 발견해서 여기에 대한 이야기를 해볼까한다.</p>
<ul>
<li>테스트하려고 설계를 망치긴 싫어요.</li>
</ul>
<p>읭??</p>
<h1>좋은 설계라구?</h1>
<p>테스트충으로써 tdd를 하면 많은 메서드와 비대한 객체로 끌려가는 건 안다. 다만<br>
그걸 리펙터링할 타이밍을 못잡는 상황이 문제인거지 이게 tdd의 문제라 생각하지는<br>
않는다. 오히려 중요한 부분인데 설계 문제로 테스트를 못한다면 난 설계에 대해<br>
다시 고민하지 테스트를 줄여서 좋은 설계를 만들자는 주장은 안할 것 같다.</p>
<h1>좋은 테스트가 좋은 설계를 보장하지 않지만 모든 좋은 설계는 좋은 테스트를 가지고 있다</h1>
<p>가령 지금 테스트를 줄여 이쁘게 코드가 나왔다고 해도 코드는 고정된 자산이 아니다.<br>
많약 그런식으로 고정할 수 있는 코드라면 그냥 한번 잘짜면 되지 에초에 테스트도<br>
필요없다.</p>
<h1>그래서 테스트 팁</h1>
<p>뭐든 많이해보고 익숙해 지는 게 최고다. 굳 올드 red-green-refactor만큼 좋은 bp를<br>
본적이 없으니 그거 그냥 하자능.</p>
<h2 id="1-red">1. red</h2>
<p>아는 범위에서 최대한 신중하게 최소 스팩을 정한다. 설계를 꼼꼼히 하고 싶다면 이<br>
단계에서 해라. 단위 테스트를 먼저하느라 설계가 이상해진다면 통합 스팩을 먼저<br>
작성해라. bdd를 한다면 문장을 만들어서 기획자한테 내가 이해한게 니가 기획한거랑<br>
일치한지 확인하는게 좋다. 근데 생각해보면 기획자의 경험이나 이해도는 내가 어떻게<br>
할 수 있는 게 아니긴하다.</p>
<h2 id="2-green">2. green</h2>
<p>아는 범위에서 최대한 구현한다. 모르는 건 어쩔 수 없다.</p>
<h2 id="3-refactor">3. refactor</h2>
<p>모든 코드가 적절한지 고민하고 필요없는 부분은 늦기전에 지운다. 딱히 정답이 있는<br>
부분도 아니고 경험이 잘 설명될 수 있는 부분도 아니고 이게 젤 힘들다.<br>
이게 잘 안되서 설계가 어쩌느니 테스트가 어쩌느니 궁시렁 되는데 나한테 권한이<br>
있고 이유를 설명할 수 있다면 모든 코드는 수정 가능하다는 마인드 셋이 가장<br>
중요하고 그 다음은 대량의 코드 수정을 어느정도의 효율로 할 수 있는가 정도<br>
아닐까. 대부분 리뷰에서 수정사항 대량으로 나오면 힘들어하는게 저쪽이라…</p>
<h1>그밖에</h1>
<ul>
<li>OOP 한정이지만 프라이빗은 테스트하는 거 아님.<br>
프라이빗이 테스트하고 싶어진다면, 객체를 나눌때가 된게 아닌가 고민해 보라능.</li>
<li>테스트할 때 의존관계 너무 많이 만드는 거 아님. 인생은 테스트 기다리며 지내기엔<br>
너무 짧다.</li>
<li>너무 완벽하려 노력하지 마라. 에초에 내 실력으로는 택도 없다. 할 수 있는<br>
범위에서 최대한 하는거지 뭐…</li>
<li>깔끔하게 개선되었을 때의 기분좋은 감각을 기억하라능.</li>
<li>일하는게 너무 헬이라 생각되면 불평하면서 계속다니지 말고 깔끔하게 이직하라능.<br>
자는 시간 빼고 80% 정도를 일하면서 지내는데 즐겁기라도 해야지.</li>
<li>개발자끼리 의견 일치를 못볼때 설득하는 거보다 짜서 보여주는게 효율적임.<br>
내가 많이 당했는데 별로 맘에 안들어도 완성품 들고오면 리젝하기 힘들더라.</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/test/">test</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/01/06/implicit-is-evil/"><span>묵시는 사악해</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/01/06/implicit-is-evil/" rel="bookmark">
        <time class="entry-date published" datetime="2017-01-05T16:11:43.000Z">
          2017-01-06
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>이 글은 <a href="http://ruby-korea.github.io/advent-calendar/" target="_blank" rel="noopener">루비 대림 달력</a>에 빈칸
매꾸려고 쓴 글입니다.</p>
<ul>
<li><a href="https://github.com/ahastudio/til/blob/master/ruby/20161207-metaprogramming.md" target="_blank" rel="noopener">7일: Ruby Meta-programming</a></li>
<li><a href="https://github.com/cavinkwon/redux.rb" target="_blank" rel="noopener">9일: Rack 으로 미들웨어 이해하기</a></li>
</ul>
<p>다음 코드의 결과를 예측해보세요.</p>
<figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="regexp">//</span></span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line">a == <span class="regexp">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line">a.! == <span class="regexp">//</span>.!</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line">!a == !<span class="regexp">//</span></span><br></pre></td></tr></table></figure>
<p>루비 2.4 기준으로 정답은 1. <code>true</code>, 2. <code>true</code>, 3. <code>false</code> 입니다.</p>
<h1 id="해설"><a href="#해설" class="headerlink" title="해설"></a>해설</h1><p>루비에서 falsey값은 아시다시피 <code>nil</code>과 <code>false</code>뿐입니다. <code>//</code>같은 정규식 객체가
falsey로 취급되는건 누가봐도 이상하죠. 이것 저것 시도하다 <code>if</code>문안에 넣어보니
단서가 될만한 경고를 찾았습니다.</p>
<figure class="highlight irb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">irb&gt; p <span class="number">1</span><span class="keyword">if</span> /<span class="regexp">/</span></span><br><span class="line"><span class="regexp">(irb):2: warning: regex literal in condition</span></span><br><span class="line"><span class="regexp">=&gt; nil</span></span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/29164490/ruby-why-do-i-get-warning-regex-literal-in-condition-here" target="_blank" rel="noopener">스택오버플로우</a>에
따르면 정규식 리터럴은 묵시적으로 <code>Regexp#~</code>로 해석되고 이는 <code>$_</code>에 대해 매칭을
수행하고 결과를 반환합니다. 결국 <code>!//</code>는 <code>! ~//</code>로 변환되고 <code>~//</code>는 <code>$_</code>에
들어있는 <code>nil</code>에 매칭해 <code>nil</code>을 반환 <code>!nil</code>은 <code>true</code>로 변환되게 됩니다.
<code>$_</code>는 변수라 여기에 값을 넣으면 행동이 바뀝니다.</p>
<figure class="highlight irb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ irb(main)<span class="symbol">:</span><span class="number">004</span><span class="symbol">:</span><span class="number">0</span>* $_ = <span class="string">"하이요"</span></span><br><span class="line">=&gt; <span class="string">"하이요"</span></span><br><span class="line">+ irb(main)<span class="symbol">:</span><span class="number">005</span><span class="symbol">:</span><span class="number">0</span>&gt; <span class="regexp">//</span></span><br><span class="line">=&gt; /<span class="regexp">/</span></span><br><span class="line"><span class="regexp">+ irb(main):006:0&gt; ~/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">=&gt; 0</span></span><br><span class="line"><span class="regexp">+ irb(main):007:0&gt; !/</span><span class="regexp">/</span></span><br><span class="line"><span class="regexp">=&gt; false</span></span><br></pre></td></tr></table></figure>
<h1 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h1><p>어쨋든 이런 묵시적 변환은 가독성을 해칩니다. 이기회에 좀더 현대적인 언어로 갈아
타던가 파서가 해석하는 대로 적어서 오해를 줄이도록 합시다.</p>
<figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">!a != ! ~<span class="regexp">//</span></span><br><span class="line"></span><br><span class="line"><span class="number">1</span>a != <span class="regexp">//</span>.match?($_)</span><br><span class="line"></span><br><span class="line">text = gets</span><br><span class="line"><span class="number">1</span>a != <span class="regexp">//</span>.match?(text)</span><br></pre></td></tr></table></figure>
<p>끗</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/ruby/">ruby</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2016/12/04/about-rspec/"><span>rspec 잘쓰고 계신가요?</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2016/12/04/about-rspec/" rel="bookmark">
        <time class="entry-date published" datetime="2016-12-04T01:00:00.000Z">
          2016-12-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>이 글은 <a href="http://ruby-korea.github.io/advent-calendar/" target="_blank" rel="noopener">루비 대림 달력</a>용으로
작성하는 글 입니다.</p>
<ul>
<li><a href="http://riseshia.github.io/2016/12/01/ruby-2-4-0-preview.html" target="_blank" rel="noopener">3일: Ruby 2.4.0 Preview</a></li>
<li><a href="https://code.iamseapy.com/archives/38" target="_blank" rel="noopener">5일: puma 웹서버 주기적으로 재시작</a></li>
</ul>
<p>tl;dr: Given, When, Then 단위로 나누어서 작성하세요.</p>
<h1 id="rspec은"><a href="#rspec은" class="headerlink" title="rspec은"></a>rspec은</h1><p>설명할 것도 없이 레일스를 사용한다면 한번은 봤을 법한 가장 대중적인 BDD테스트
프레임 워크입니다.</p>
<h1 id="BDD는-뭔가요"><a href="#BDD는-뭔가요" class="headerlink" title="BDD는 뭔가요"></a>BDD는 뭔가요</h1><p>사양을 기술에 집중하는 TDD의 확장입니다. 루비에서는 rspec말고도 minitest-spec,
cucumber, rspec-feature등을 사용해 할 수도 있습니다. 특정 서브젝트에 대해 조건을
주고 그 결과를 확인하는 3단계로 나누어 작성하는게 특징입니다. 에러를 읽기도 쉽고
찾기도 쉽죠.</p>
<h1 id="코드로-이야기-합시다"><a href="#코드로-이야기-합시다" class="headerlink" title="코드로 이야기 합시다"></a>코드로 이야기 합시다</h1><p>다음과 같은 사양서의 테스트를 작성해 봅시다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">기능: Stack</span><br><span class="line"></span><br><span class="line">조건 새 스택을 만듬</span><br><span class="line">그러면 비어있음</span><br><span class="line"></span><br><span class="line">만일 스택에 요소가 추가됨</span><br><span class="line">그러면 그 요소가 스택의 제일 위에 위치함</span><br><span class="line"></span><br><span class="line">만일 스택이 N개의 요소를 가짐</span><br><span class="line">그리고 요소 E가 스택의 제일 위에 위치함</span><br><span class="line">그러면 팝 연산은 E를 반환함</span><br><span class="line">그리고 새 스택 크기는 N-1이 됨</span><br></pre></td></tr></table></figure>
<p>먼저 minitest로 작성해 보면 이렇게 될 것 같습니다.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StackTest</span> &lt; Minitest::Test</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">setup</span></span></span><br><span class="line">    @stack = Stack.new</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test_new</span></span></span><br><span class="line">    assert @stack.empty?</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test_add</span></span></span><br><span class="line">    @stack.add(<span class="string">"A"</span>)</span><br><span class="line">    assert_equal <span class="string">"A"</span>, @stack.top</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">test_pop</span></span></span><br><span class="line">    elements = <span class="string">%w(A B C D E)</span></span><br><span class="line">    elements.each &#123; <span class="params">|e|</span> @stack.add(e) &#125;</span><br><span class="line">    assert_equal <span class="string">"E"</span>, @stack.pop</span><br><span class="line">    assert_equal <span class="number">4</span>, @stack.size</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>일단 있는 그대로 rspec문법으로 옮겨보죠.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">RSpec.describe Stack <span class="keyword">do</span></span><br><span class="line">  subject(<span class="symbol">:stack</span>) &#123; Stack.new &#125;</span><br><span class="line"></span><br><span class="line">  it <span class="string">".new"</span> <span class="keyword">do</span></span><br><span class="line">    is_expected.to be_empty</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  it <span class="string">"#top"</span> <span class="keyword">do</span></span><br><span class="line">    stack.add(<span class="string">"A"</span>)</span><br><span class="line">    expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  it <span class="string">"#pop"</span> <span class="keyword">do</span></span><br><span class="line">    elements = <span class="string">%w(A B C D E)</span></span><br><span class="line">    elements.each &#123; <span class="params">|e|</span> stack.add(e) &#125;</span><br><span class="line">    expect(stack.pop).to eq <span class="string">"E"</span></span><br><span class="line">    expect(stack.size).to be <span class="number">4</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>TDD일때는 문제가 안되지만, 이런 코드는 설명을 코드의 구현에 의존하기 때문에
설명충이 미덕인 BDD로써는 좋은 코드가 아닙니다. 단계별로 개선해 봅시다.</p>
<h2 id="describe-사용하기"><a href="#describe-사용하기" class="headerlink" title="describe 사용하기"></a>describe 사용하기</h2><p>사양서의 Given에 해당하는 부분이고 테스트 할 대상을 지정할 때 사용하는 키워드
입니다. 이미 Stack이 describe 되어있긴 하지만, 관례대로 클래스명 -&gt; 메서드명의
두 단계로 넣어 무엇을 태스트하는지 좀 더 명확하게 하겠습니다.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">RSpec.describe Stack <span class="keyword">do</span></span><br><span class="line">  subject(<span class="symbol">:stack</span>) &#123; Stack.new &#125;</span><br><span class="line">  describe <span class="string">".new"</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">"비어 있음"</span> <span class="keyword">do</span></span><br><span class="line">      expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">"#top"</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">"만일 스택에 요소가 추가됨 그러면 그 요소가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">      stack.add(<span class="string">"A"</span>)</span><br><span class="line">      expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">"#pop"</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">"만일 스택이 N개의 요소를 가짐 그리고 요소 E가 스택의 제일 위에 위치함"</span> \</span><br><span class="line">       <span class="string">"그러면 팝 연산은 E를 반환함 그리고 새 스택 크기는 N-1이 됨"</span> <span class="keyword">do</span></span><br><span class="line">      elements = <span class="string">%w(A B C D E)</span></span><br><span class="line">      elements.each &#123; <span class="params">|e|</span> stack.add(e) &#125;</span><br><span class="line">      expect(stack.pop).to eq <span class="string">"E"</span></span><br><span class="line">      expect(stack.size).to be <span class="number">4</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>아직 설명이 너무 길군요. 조금 더 분해해 봅시다.</p>
<h2 id="context-사용하기"><a href="#context-사용하기" class="headerlink" title="context 사용하기"></a>context 사용하기</h2><p>조건을 정의할 때 사용합니다. 사양의 만일(When)에 해당하는 부분이죠.
중요한 포인트는 context와 before를 하나의 묶음 처럼 생각하는 것입니다.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="string">"#top"</span> <span class="keyword">do</span></span><br><span class="line">  context <span class="string">"만일 스택에 요소가 추가됨"</span> <span class="keyword">do</span></span><br><span class="line">    before &#123; stack.add(<span class="string">"A"</span>) &#125;</span><br><span class="line">    it <span class="string">"그러면 그 요소가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">      expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">describe <span class="string">"#pop"</span> <span class="keyword">do</span></span><br><span class="line">  context <span class="string">"만일 스택이 N개의 요소를 가짐 그리고 요소 E가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">    before &#123; <span class="string">%w(A B C D E)</span>.each &#123; <span class="params">|e|</span> stack.add(e) &#125; &#125;</span><br><span class="line">    it <span class="string">"그러면 팝 연산은 E를 반환함 그리고 새 스택 크기는 N-1이 됨"</span> <span class="keyword">do</span></span><br><span class="line">      expect(stack.pop).to eq <span class="string">"E"</span></span><br><span class="line">      expect(stack.size).to be <span class="number">4</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="부작용-없에기"><a href="#부작용-없에기" class="headerlink" title="부작용 없에기"></a>부작용 없에기</h2><p>BDD의 세계에서는 실행 시간을 희생해서라도 부작용을 없에고 싶어합니다. it 하나에
expect하나 이상 사용하는것은 좋지않은 징후죠. 나누어 보겠습니다.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">describe <span class="string">"#pop"</span> <span class="keyword">do</span></span><br><span class="line">  context <span class="string">"만일 스택이 N개의 요소를 가짐 그리고 요소 E가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">    before &#123; <span class="string">%w(A B C D E)</span>.each &#123; <span class="params">|e|</span> stack.add(e) &#125; &#125;</span><br><span class="line">    it <span class="string">"그러면 팝 연산은 E를 반환함"</span> <span class="keyword">do</span></span><br><span class="line">      expect(stack.pop).to eq <span class="string">"E"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    it <span class="string">"그러면 팝연산 후의 새 스택 크기는 N-1이 됨"</span> <span class="keyword">do</span></span><br><span class="line">      stack.pop</span><br><span class="line">      expect(stack.size).to be <span class="number">4</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>이제 더 할일이 없어보이네요.</p>
<h2 id="일단-완성"><a href="#일단-완성" class="headerlink" title="일단 완성"></a>일단 완성</h2><p>전체 코드는 이렇습니다.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">RSpec.describe Stack <span class="keyword">do</span></span><br><span class="line">  subject(<span class="symbol">:stack</span>) &#123; Stack.new &#125;</span><br><span class="line">  describe <span class="string">".new"</span> <span class="keyword">do</span></span><br><span class="line">    it <span class="string">"비어 있음"</span> <span class="keyword">do</span></span><br><span class="line">      expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">"#top"</span> <span class="keyword">do</span></span><br><span class="line">    context <span class="string">"만일 스택에 요소가 추가됨"</span> <span class="keyword">do</span></span><br><span class="line">      before &#123; stack.add(<span class="string">"A"</span>) &#125;</span><br><span class="line">      it <span class="string">"그러면 그 요소가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">        expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">"#pop"</span> <span class="keyword">do</span></span><br><span class="line">    context <span class="string">"만일 스택이 N개의 요소를 가짐 그리고 요소 E가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">      before &#123; <span class="string">%w(A B C D E)</span>.each &#123; <span class="params">|e|</span> stack.add(e) &#125; &#125;</span><br><span class="line">      it <span class="string">"그러면 팝 연산은 E를 반환함"</span> <span class="keyword">do</span></span><br><span class="line">        expect(stack.pop).to eq <span class="string">"E"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      it <span class="string">"그러면 팝연산 후의 새 스택 크기는 N-1이 됨"</span> <span class="keyword">do</span></span><br><span class="line">        stack.pop</span><br><span class="line">        expect(stack.size).to be <span class="number">4</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>보시는 것 처럼 TDD 스타일에 비해 자연어에 가깝게 적으려는 노오오력이 많이
필요합니다. 하지만 내부 코드를 몰라도 단계적으로 조건의 설명이 명확히 되는건
장점이라 할 수 있죠. 저는 이정도로 만족합니다만, 좀 더 bdd사양에 가깝게
작성하시고 싶으시면 rspec-given이라는 dsl이 있긴 합니다.</p>
<h2 id="rspec-given"><a href="#rspec-given" class="headerlink" title="rspec-given"></a>rspec-given</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">RSpec.describe Stack <span class="keyword">do</span></span><br><span class="line">  Given(<span class="symbol">:stack</span>) &#123; Stack.new &#125;</span><br><span class="line">  describe <span class="string">".new"</span> <span class="keyword">do</span></span><br><span class="line">    Then <span class="string">"비어 있음"</span> <span class="keyword">do</span></span><br><span class="line">      expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">"#top"</span> <span class="keyword">do</span></span><br><span class="line">    context <span class="string">"만일 스택에 요소가 추가됨"</span> <span class="keyword">do</span></span><br><span class="line">      When &#123; stack.add(<span class="string">"A"</span>) &#125;</span><br><span class="line">      Then <span class="string">"그러면 그 요소가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">        expect(stack.top).to eq <span class="string">"A"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  describe <span class="string">"#pop"</span> <span class="keyword">do</span></span><br><span class="line">    context <span class="string">"만일 스택이 N개의 요소를 가짐 그리고 요소 E가 스택의 제일 위에 위치함"</span> <span class="keyword">do</span></span><br><span class="line">      When &#123; <span class="string">%w(A B C D E)</span>.each &#123; <span class="params">|e|</span> stack.add(e) &#125; &#125;</span><br><span class="line">      Then <span class="string">"그러면 팝 연산은 E를 반환함"</span> <span class="keyword">do</span></span><br><span class="line">        expect(stack.pop).to eq <span class="string">"E"</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      Then <span class="string">"그러면 팝연산 후의 새 스택 크기는 N-1이 됨"</span> <span class="keyword">do</span></span><br><span class="line">        stack.pop</span><br><span class="line">        expect(stack.size).to be <span class="number">4</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>큐컴버 만큼은 아니지만, 어느정도 정돈되어 보이네요.</p>
<h1 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h1><p>bdd에 충실하게 rspec을 작성하는 법을 알아 보았습니다. 일정이 바쁘다던가
사양이 복잡하던가 이러저러한 이유가 있긴하겠지만
<a href="http://www.rubyinside.com/dhh-offended-by-rspec-debate-4610.html" target="_blank" rel="noopener">DHH도 불평</a>
못하게 깔끔하게 작성하도록 노력해봅시다. :)</p>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a href="http://www.chrisdpeters.com/introduction-feature-specs-rspec/" target="_blank" rel="noopener">http://www.chrisdpeters.com/introduction-feature-specs-rspec/</a></li>
<li><a href="https://cucumber.io/" target="_blank" rel="noopener">https://cucumber.io/</a></li>
<li><a href="https://github.com/rspec-given/rspec-given" target="_blank" rel="noopener">https://github.com/rspec-given/rspec-given</a></li>
<li><a href="http://betterspecs.org/ko/" target="_blank" rel="noopener">http://betterspecs.org/ko/</a></li>
<li><a href="https://en.wikipedia.org/wiki/Behavior-driven_development" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Behavior-driven_development</a></li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/ruby/">ruby</a><a href="/tags/rspec/">rspec</a><a href="/tags/bdd/">bdd</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2016/10/28/custom-assert-in-exunit/"><span>Custom matcher in exunit</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2016/10/28/custom-assert-in-exunit/" rel="bookmark">
        <time class="entry-date published" datetime="2016-10-27T19:44:05.000Z">
          2016-10-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="동기"><a href="#동기" class="headerlink" title="동기"></a>동기</h1><p>그냥 <code>assert Regex.match?(regex, actual)</code>는 true/false만 반환해서 디버깅할 때
곤란했는데, 이걸 매번 메세지로 찍어주자니 귀찮아서 아예 매쳐로 만들어 볼려고
하니 문서로 설명되어있지 않아서 정리겸..</p>
<h1 id="준비"><a href="#준비" class="headerlink" title="준비"></a>준비</h1><p>피닉스는 이미 설정 되어있어서 필요없지만 직접 만든 라이브러리라면,
루비에서처럼 require로는 못하고 mix.exs에서 로드 경로를 설정해야 한다.
테스트 환경에서만 로드하게 할려면 이렇게 하면된다.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">project</span></span> <span class="keyword">do</span></span><br><span class="line">[...,</span><br><span class="line"> <span class="symbol">elixirc_paths:</span> elixirc_paths(Mix.env),</span><br><span class="line"> ...]</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">elixirc_paths</span></span>(<span class="symbol">:test</span>), <span class="symbol">do:</span> [<span class="string">"lib"</span>, <span class="string">"test/support"</span>]</span><br><span class="line"><span class="function"><span class="keyword">defp</span> <span class="title">elixirc_paths</span></span>(_),     <span class="symbol">do:</span> [<span class="string">"lib"</span>]</span><br></pre></td></tr></table></figure>
<p>설정후에 일단 한번 컴파일 해주자.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mix compile</span><br></pre></td></tr></table></figure>
<h1 id="매쳐-작성"><a href="#매쳐-작성" class="headerlink" title="매쳐 작성"></a>매쳐 작성</h1><p>내가 필요했던건 정규식으로 스트링을 검증해주는 매쳐다.
test/support 안에 넣어준다. 파일명이 exs가 아니라 ex인것에 주의.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">defmodule</span> <span class="title">ProjectName.Matcher</span></span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">import</span> ExUnit.Assertions, <span class="symbol">only:</span> [<span class="symbol">assert:</span> <span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">assert_match</span></span>(regex, actual) <span class="keyword">do</span></span><br><span class="line">    assert Regex.match?(regex, actual), <span class="string">"<span class="subst">#&#123;actual&#125;</span> is not match."</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h1 id="사용"><a href="#사용" class="headerlink" title="사용"></a>사용</h1><p>평범하게 임포트해서 사용하면 된다.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ProjectName.Matcher, <span class="symbol">only:</span> [<span class="symbol">assert_match:</span> <span class="number">2</span>]</span><br><span class="line">test <span class="string">"123 matches \\d+"</span> <span class="keyword">do</span></span><br><span class="line">  assert_match <span class="string">~r/\A\d+\z/</span>, <span class="string">"123"</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>끝.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a><a href="/tags/exunit/">exunit</a><a href="/tags/test/">test</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2016/10/17/elm-from-elixir/"><span>elm from elixir</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2016/10/17/elm-from-elixir/" rel="bookmark">
        <time class="entry-date published" datetime="2016-10-17T01:25:02.000Z">
          2016-10-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>이 글은 뽐뿌 글이 아니니 엘름의 좋은 점을 알고싶다면  <a href="http://bestalign.github.io/2015/11/28/elm-for-javascript-developers/index.html" target="_blank" rel="noopener">다른
글</a>을
읽으세요.</p>
<h1 id="연산자"><a href="#연산자" class="headerlink" title="연산자"></a>연산자</h1><p>조금 다르긴한데 많이 신경쓰이는 정도는 아니다.
몇가지 주목할 부분은..</p>
<ul>
<li><code>!=</code>대신 <code>\=</code>을 사용한다.</li>
<li>and or가 없다.</li>
<li><code>||</code> <code>&amp;&amp;</code> 도 Bool 타입만 받아서 엘릭서에서 인라인 if 대신 사용하던
<code>valid or raise Error</code> 를 사용할 수 없다.</li>
<li><code>/</code> 는 Float를 반환한다.</li>
<li><code>div/2</code> 는 <code>//</code> 로 <code>rem/2</code>은 <code>%</code>로 사용할 수 있다.</li>
</ul>
<h1 id="함수"><a href="#함수" class="headerlink" title="함수"></a>함수</h1><p>basic 문서에 파이프가  없어서 없구나 싶었는데 그냥 메서드에 있었다 .
엘릭서에는 없던 파이프가 몇개 더 있다. 커링에 더 특화되어 있는 느낌.</p>
<h1 id="강타입과-컴파일"><a href="#강타입과-컴파일" class="headerlink" title="강타입과 컴파일"></a>강타입과 컴파일</h1><p>아.. 정말 여태까지 이렇게 채크해주는 언어를 해본적이 없어서 정말 미쳐버리는 줄
알았는데 어느 정도 익숙해졌다. 일단 함수 선언 위에 타입을 전부 적어야 하고 이게
실제 리턴 값과 다르면 컴파일이 안된다.
처음에는 타입 맞추느라 삽질많이 했는데 익숙 해지니 그냥 저냥 할 만 하다. 루비나
엘릭서에서는 파이프연결해 중간값 확인하면서 코딩했었는데 최종 타입 맞지않으면
실행이 안되니 그런식으로 코딩하기 힘들어졌다. 일단 제일 많이 삽질했던 두 개만
언급하고 넘어가자.</p>
<h2 id="Maybe-XX"><a href="#Maybe-XX" class="headerlink" title="Maybe XX"></a>Maybe XX</h2><p>그냥 해당 타입이거나 Nothing을 반환 하는데 성공 했을때 (Just XX) 실패 했을때
(Nothing)으로 나온다 map같은 이터레이터에 먹일 때 보통 이런 상태 말고 값만
있을거라 예상하는데, 그렇지 않으니 처리하기 좀 번거롭다. 난 보통 케이스로
처리한다.</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">case</span> a <span class="keyword">of</span></span><br><span class="line">    <span class="type">Just</span> x -&gt; x</span><br><span class="line">    <span class="type">Nothing</span> -&gt; <span class="type">Debug</span>.crash(<span class="string">"error"</span>)</span><br></pre></td></tr></table></figure>
<p>뭐.. 당연한 이야기지만 결과가 nil이 아니므로</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value || default</span><br></pre></td></tr></table></figure>
<p>같은 식으로는 쓸 수 없다. 이렇게 해야한다.</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Maybe</span>.withDefault <span class="number">100</span> (<span class="type">Just</span> <span class="number">42</span>)   <span class="comment">-- 42</span></span><br><span class="line"><span class="type">Maybe</span>.withDefault <span class="number">100</span> <span class="type">Nothing</span>     <span class="comment">-- 100</span></span><br></pre></td></tr></table></figure>
<p>이터레이터 안에서 value만 뽑고 싶을 때에는 이렇게 하면된다.
(내가 할 줄 몰라서) 좀 괴로웠다.</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">modifyList</span> : <span class="type">List</span> -&gt; <span class="type">Maybe</span> <span class="type">Nothing</span> (<span class="type">List</span> a)</span><br><span class="line"><span class="title">modifyList</span> list =</span><br><span class="line">    list</span><br><span class="line">        |&gt; some_maybe_methods</span><br><span class="line">        |&gt; <span class="type">List</span>.foldr (<span class="type">Maybe</span>.map2 (::)) (<span class="type">Just</span> [])</span><br></pre></td></tr></table></figure>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>성공했을 때 (Ok value), 실패했을 때 (Err reason)이 나온다.
이녀석도 케이스로 처리해야 한다. 그거말고는 Maybe랑 비슷하게 하면 된다.</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">case</span> a <span class="keyword">of</span></span><br><span class="line">    <span class="type">Just</span> x -&gt; x</span><br><span class="line">    <span class="type">Nothing</span> -&gt; <span class="type">Debug</span>.crash(<span class="string">"error"</span>)</span><br></pre></td></tr></table></figure>
<h1 id="파이프-순서"><a href="#파이프-순서" class="headerlink" title="파이프 순서"></a>파이프 순서</h1><p>엘릭서와 다르게 제일 뒤에 있는게 사용되는데,  덕분에 가독성에서 좀 손해를
보는 느낌이다. 예를 들자면 적어도 나에게는</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span>.contains? <span class="string">"elixir of life"</span>, <span class="string">"of"</span></span><br></pre></td></tr></table></figure>
<p>보다는</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span>.contains <span class="string">"of"</span> <span class="string">"elm tree of life"</span></span><br></pre></td></tr></table></figure>
<p>가 읽기 힘들다.</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"elm tree of life"</span> |&gt; <span class="type">String</span>.contains <span class="string">"of"</span></span><br></pre></td></tr></table></figure>
<p>라고 적을 수 있긴하다. 실제로 그렇게 적을지는 또 다른 문제지만,</p>
<p>라고 적으면 나쁜 점만 있는것 같지만.. 사실 커링 때문에 더 편해진 것도 많다.
이런 상황을 생각해보자.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span></span>(a, b), <span class="symbol">do:</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_all</span></span>(list, num) <span class="keyword">do</span></span><br><span class="line">  list</span><br><span class="line">  |&gt; Enum.map(&amp;add(&amp;<span class="number">1</span>, num))</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>엘릭서에서는 아리티가 일치하지 않으면 외부 참조를 넘길수 없어서 이런
레핑이 최선이었다.</p>
<p>하지만 엘름은 다르다.</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">add</span> : <span class="type">Int</span> -&gt; <span class="type">Int</span> -&gt; <span class="type">Int</span></span><br><span class="line"><span class="title">add</span> a b =</span><br><span class="line">    a + b</span><br><span class="line"></span><br><span class="line"><span class="title">addAll</span> : <span class="type">Int</span> -&gt; <span class="type">List</span> a -&gt; <span class="type">List</span> a</span><br><span class="line"><span class="title">addAll</span> num list =</span><br><span class="line">    <span class="keyword">let</span></span><br><span class="line">        plusNum = (add num)</span><br><span class="line">    <span class="keyword">in</span></span><br><span class="line">        list</span><br><span class="line">            |&gt; <span class="type">List</span>.map plusNum</span><br></pre></td></tr></table></figure>
<p>인자가 불완전하게 넘겨진 상태도 함수이므로 그걸 그대로 함수 인자로 넘길 수 있다.</p>
<h1 id="패턴-매칭"><a href="#패턴-매칭" class="headerlink" title="패턴 매칭"></a>패턴 매칭</h1><p>모든 조건을 커버 하지 못하면 컴파일이 안된다. 특히 리스트가 컴파일 시점에서
갯수까지는 알수 없기때문에 let에는 디스트럭쳐링 할 수 없고 case를 사용해야 한다.</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[a, b, c] = list |&gt; Enum.sort</span><br></pre></td></tr></table></figure>
<p>그래서 위에 있는 엘릭서에서는 간단히 되던 코드가 이렇게 되버렸다.</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">case</span> (<span class="type">List</span>.sort list) <span class="keyword">of</span></span><br><span class="line">    a::b::c::[] -&gt; ...</span><br><span class="line">    _ -&gt; <span class="type">Debug</span>.crash(<span class="string">"Impossible"</span>)</span><br></pre></td></tr></table></figure>
<p>with도 없고 리스트 몇개만 매칭으로 풀어도 case중첩으로 산으로 가서
타입에따라서는 그냥 없다고 생각하고 작성하는게 편할 수도 있다. 패턴 매칭이
약해서 if else 구문을 평범하게 사용하는것도 다른 문화.</p>
<h1 id="기타"><a href="#기타" class="headerlink" title="기타"></a>기타</h1><ul>
<li>List의 렌덤 억세스에 관한 함수가 없다. 굳이 하고 싶으면 어레이로 변환해서
해야한다. 근데 변환 여러번 하는 거보다 head tail로 어찌어찌하는게 비용이 적을
것 같다.</li>
<li>요즘은 어떨지 모르겠는데 옛날에 자바 싫어하는 이유 중 하나가 정규식 쓰기
힘들어서 였는데 , 정규식용 리터럴이 따로 준비되어있지 않고 스트링으로 해서
자바에서 정규식 쓰던 생각난다.</li>
</ul>
<h1 id="결론"><a href="#결론" class="headerlink" title="결론"></a>결론</h1><p>단순하게 되던게 번거로워 진 부분이 좀 많아서 생산성만 좀 더 뽑을 수 있으면 좋을
것 같다는 생각을 했다.</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/elixir/">elixir</a><a href="/tags/elm/">elm</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2016/09/29/bash-tips/"><span>Bash tips</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2016/09/29/bash-tips/" rel="bookmark">
        <time class="entry-date published" datetime="2016-09-29T06:13:26.000Z">
          2016-09-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>안적어두면 자꾸까먹어서 정리할 겸..</p>
<h1 id="여러-파일-치환"><a href="#여러-파일-치환" class="headerlink" title="여러 파일 치환"></a>여러 파일 치환</h1><p>이런 작업은 vim에서 하는거보다는 밖에서 하는게 빠르고 정규식도 POSIX라 편하다.
오타 수정할 때 쓰면 좋다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -pi -e <span class="string">'s/old-string/new-string/g'</span> my-files-*.txt</span><br></pre></td></tr></table></figure>
<p>조금 덧붙여서 커밋된 파일만 순회할 수도 있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -pi -e <span class="string">'s/old-string/new-string/g'</span> $(git ls-tree HEAD --name-only -r)</span><br></pre></td></tr></table></figure>
<p>특정 폴더만 지정하려면 – 쓰면된다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">perl -pi -e <span class="string">'s/old-string/new-string/g'</span> \</span><br><span class="line">  $(git ls-tree HEAD --name-only -r -- ./folder)</span><br></pre></td></tr></table></figure>
<h1 id="clipboard-내용으로-사전열기"><a href="#clipboard-내용으로-사전열기" class="headerlink" title="clipboard 내용으로 사전열기"></a>clipboard 내용으로 사전열기</h1><p>번역하고 있을때 유용하게 쓴다.
OSX한정이고 bash tip이 아닐지도 모르겠는데 이렇게 한다.
alias로 해두면 세손가락 더블탭보다 스트로크가 적다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open -a /Applications/Dictionary.app/ --args $(pbpaste)</span><br></pre></td></tr></table></figure>
<h1 id="패턴에-따라-여러파일-지정하기"><a href="#패턴에-따라-여러파일-지정하기" class="headerlink" title="패턴에 따라 여러파일 지정하기"></a>패턴에 따라 여러파일 지정하기</h1><p>디렉토리 구조가 비슷하다거나. 확장자만 조금 다르거나 할 때 사용할 수있다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#123;ko,.&#125;/lessions/basic/test.md</span><br><span class="line">vim readme.&#123;ko,en&#125;.md</span><br></pre></td></tr></table></figure>
<h1 id="if-statement"><a href="#if-statement" class="headerlink" title="if statement"></a>if statement</h1><p>기본적으로 이렇다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [[ condition ]]; <span class="keyword">then</span></span><br><span class="line">  something</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  something</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>구문은 딱히 특별할거 없고, condition만 신경쓰면 된다.</p>
<table>
<thead>
<tr>
<th>명령</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>! 표현식</td>
<td>표현식이 참이 아님</td>
</tr>
<tr>
<td>-n 문자열</td>
<td>문자열의 길이가 0보다 큼</td>
</tr>
<tr>
<td>-z 문자열</td>
<td>문자열의 길이가 0</td>
</tr>
<tr>
<td>문자열1 = 문자열2</td>
<td>두문자열이 같음</td>
</tr>
<tr>
<td>문자열1 != 문자열2</td>
<td>두문자열이 다름</td>
</tr>
<tr>
<td>숫자1 -eq 숫자2</td>
<td>두숫자가 같음</td>
</tr>
<tr>
<td>숫자1 -ne 숫자2</td>
<td>두숫자가 다름</td>
</tr>
<tr>
<td>숫자1 -gt 숫자2</td>
<td>숫자1이 숫자2보다 큼</td>
</tr>
<tr>
<td>숫자1 -lt 숫자2</td>
<td>숫자1이 숫자2보다 작음</td>
</tr>
<tr>
<td>-d 파일</td>
<td>디렉토리가 있음</td>
</tr>
<tr>
<td>-e 파일</td>
<td>파일이 있음</td>
</tr>
<tr>
<td>-r 파일</td>
<td>파일이 있고 읽기권한이 있음</td>
</tr>
<tr>
<td>-s 파일</td>
<td>파일이 있고 크기가 0보다 큼</td>
</tr>
<tr>
<td>-w 파일</td>
<td>파일이 있고 쓰기권한이 있음</td>
</tr>
<tr>
<td>-x 파일</td>
<td>파일이 있고 실행권한이 있음</td>
</tr>
</tbody>
</table>
<h1 id="변수들"><a href="#변수들" class="headerlink" title="$변수들"></a>$변수들</h1><table>
<thead>
<tr>
<th>표현</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr>
<td>$0</td>
<td>셸스크립트 이름</td>
</tr>
<tr>
<td>$1</td>
<td>첫 번째 인자</td>
</tr>
<tr>
<td>$2</td>
<td>두 번째 인자</td>
</tr>
<tr>
<td>$@</td>
<td>인자 배열</td>
</tr>
<tr>
<td>$#</td>
<td>인자 개수</td>
</tr>
</tbody>
</table>
<h1 id="기본값-설정하기"><a href="#기본값-설정하기" class="headerlink" title="기본값 설정하기"></a>기본값 설정하기</h1><p>변수가 할당안됐을 기본값을 지정할 수 있다. if문을 줄이려할 때 유용.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> Hello, <span class="variable">$&#123;NAME-World&#125;</span>! <span class="comment"># =&gt; Hello, World!</span></span><br><span class="line">NAME=Alice</span><br><span class="line"><span class="built_in">echo</span> Hello, <span class="variable">$&#123;NAME-World&#125;</span>! <span class="comment"># =&gt; Hello, Alice!</span></span><br></pre></td></tr></table></figure>
<h1 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h1><p><a href="https://www.gnu.org/software/bash/manual/html_node/Special-Parameters.html" target="_blank" rel="noopener">https://www.gnu.org/software/bash/manual/html_node/Special-Parameters.html</a>
<a href="http://www.tldp.org/LDP/abs/html/parameter-substitution.html" target="_blank" rel="noopener">http://www.tldp.org/LDP/abs/html/parameter-substitution.html</a>
<a href="https://github.com/jlevy/the-art-of-command-line/blob/master/README-ko.md" target="_blank" rel="noopener">https://github.com/jlevy/the-art-of-command-line/blob/master/README-ko.md</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/bash/">bash</a><a href="/tags/fish/">fish</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">Next</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 marocchino
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>