<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Phoenix and Webpack | A study note</title>

  
  <meta name="author" content="marocchino">
  

  
  <meta name="description" content="동기
브런치보다 웹팩이 익숙하고 유지보수 잘되고 유저가 많다.
이왕할거면 초기에 하는게 나중에 하는거보다 덜 골치아프다.

환경사용한 버전은 이렇다.

Elixir 1.3.3
Phoenix 1.2.1
Node 6.6.0

과정브런치 없이 설치하는게 더 귀찮은데, 이미 ">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="Phoenix and Webpack"/>

  <meta property="og:site_name" content="A study note"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="A study note" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">A study note</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>Phoenix and Webpack</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2016/09/24/phoenix-and-webpack/" rel="bookmark">
        <time class="entry-date published" datetime="2016-09-24T00:35:36.000Z">
          2016-09-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1 id="동기"><a href="#동기" class="headerlink" title="동기"></a>동기</h1><ul>
<li>브런치보다 웹팩이 익숙하고 유지보수 잘되고 유저가 많다.</li>
<li>이왕할거면 초기에 하는게 나중에 하는거보다 덜 골치아프다.</li>
</ul>
<h1 id="환경"><a href="#환경" class="headerlink" title="환경"></a>환경</h1><p>사용한 버전은 이렇다.</p>
<ul>
<li>Elixir 1.3.3</li>
<li>Phoenix 1.2.1</li>
<li>Node 6.6.0</li>
</ul>
<h1 id="과정"><a href="#과정" class="headerlink" title="과정"></a>과정</h1><p>브런치 없이 설치하는게 더 귀찮은데, 이미 오래전에 없이 설치해버려서.. 그냥 둘 다
설명하겠다.</p>
<p><a href="https://github.com/kenips/phoenix/blob/master/installer/lib/phoenix_new.ex#L48-L57" target="_blank" rel="noopener">소스 코드</a>를
<a href="https://github.com/phoenixframework/phoenix/blob/master/installer/lib/phoenix_new.ex#L70-L76" target="_blank" rel="noopener">확인해도</a>
알 수 있지만 .gitignore의 내용이 다른걸 재외하면, 두 방식의 파일 차이는 이 정도
이다.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">-* creating with_brunch/brunch-config.js</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/package.json</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/web/static/css/app.css</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/web/static/css/phoenix.css</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/web/static/assets/favicon.ico</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/web/static/assets/images/phoenix.png</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/web/static/js/app.js</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/web/static/js/socket.js</span></span><br><span class="line"><span class="deletion">-* creating with_brunch/web/static/assets/robots.txt</span></span><br><span class="line"><span class="addition">+* creating without_brunch/priv/static/css/app.css</span></span><br><span class="line"><span class="addition">+* creating without_brunch/priv/static/favicon.ico</span></span><br><span class="line"><span class="addition">+* creating without_brunch/priv/static/images/phoenix.png</span></span><br><span class="line"><span class="addition">+* creating without_brunch/priv/static/js/app.js</span></span><br><span class="line"><span class="addition">+* creating without_brunch/priv/static/js/phoenix.js</span></span><br><span class="line"><span class="addition">+* creating without_brunch/priv/static/robots.txt</span></span><br></pre></td></tr></table></figure>
<p>레일스 감각으로 말하면, web/static은 app/assets이고 priv/static은 public/assets
다. frontend같은 다른 경로를 사용해도 되긴하는데 스포클렛처럼 타이트하게 묶여
있거나 묵시적으로 처리하는 부분이 있는게 아니라, 두 경우 모두 web/static을
사용하도록 하겠다.</p>
<h2 id="파일-구조-잡기"><a href="#파일-구조-잡기" class="headerlink" title="파일 구조 잡기"></a>파일 구조 잡기</h2><h3 id="브런치-없이-설치한-경우"><a href="#브런치-없이-설치한-경우" class="headerlink" title="브런치 없이 설치한 경우"></a>브런치 없이 설치한 경우</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">$ mix phoenix.new without_brunch --no-brunch</span><br><span class="line">* creating without_brunch/config/config.exs</span><br><span class="line">* creating without_brunch/config/dev.exs</span><br><span class="line">* creating without_brunch/config/prod.exs</span><br><span class="line">* creating without_brunch/config/prod.secret.exs</span><br><span class="line">* creating without_brunch/config/test.exs</span><br><span class="line">* creating without_brunch/lib/without_brunch.ex</span><br><span class="line">* creating without_brunch/lib/without_brunch/endpoint.ex</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/views/error_view_test.exs</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/support/conn_case.ex</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/support/channel_case.ex</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/test_helper.exs</span><br><span class="line">* creating without_brunch/web/channels/user_socket.ex</span><br><span class="line">* creating without_brunch/web/router.ex</span><br><span class="line">* creating without_brunch/web/views/error_view.ex</span><br><span class="line">* creating without_brunch/web/web.ex</span><br><span class="line">* creating without_brunch/mix.exs</span><br><span class="line">* creating without_brunch/README.md</span><br><span class="line">* creating without_brunch/web/gettext.ex</span><br><span class="line">* creating without_brunch/priv/gettext/errors.pot</span><br><span class="line">* creating without_brunch/priv/gettext/en/LC_MESSAGES/errors.po</span><br><span class="line">* creating without_brunch/web/views/error_helpers.ex</span><br><span class="line">* creating without_brunch/lib/without_brunch/repo.ex</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/support/model_case.ex</span><br><span class="line">* creating without_brunch/priv/repo/seeds.exs</span><br><span class="line">* creating without_brunch/.gitignore</span><br><span class="line">* creating without_brunch/priv/static/css/app.css</span><br><span class="line">* creating without_brunch/priv/static/js/app.js</span><br><span class="line">* creating without_brunch/priv/static/robots.txt</span><br><span class="line">* creating without_brunch/priv/static/js/phoenix.js</span><br><span class="line">* creating without_brunch/priv/static/images/phoenix.png</span><br><span class="line">* creating without_brunch/priv/static/favicon.ico</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/controllers/page_controller_test.exs</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/views/layout_view_test.exs</span><br><span class="line">* creating without_brunch/<span class="built_in">test</span>/views/page_view_test.exs</span><br><span class="line">* creating without_brunch/web/controllers/page_controller.ex</span><br><span class="line">* creating without_brunch/web/templates/layout/app.html.eex</span><br><span class="line">* creating without_brunch/web/templates/page/index.html.eex</span><br><span class="line">* creating without_brunch/web/views/layout_view.ex</span><br><span class="line">* creating without_brunch/web/views/page_view.ex</span><br></pre></td></tr></table></figure>
<p>먼저 .gitignore에 node_modules, priv/static/ 을 추가한다.
이 위치는 컴파일 후의 스테틱 파일이 올자리이다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Static artifacts</span></span><br><span class="line">/node_modules</span><br><span class="line"></span><br><span class="line"><span class="comment"># Since we are building assets from web/static,</span></span><br><span class="line"><span class="comment"># we ignore priv/static. You may want to comment</span></span><br><span class="line"><span class="comment"># this depending on your deployment strategy.</span></span><br><span class="line">/priv/static/</span><br></pre></td></tr></table></figure>
<p>다음은 파일을 옮기고 필요없는 파일을 지운다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p web/static/assets/images web/static/js web/static/css</span><br><span class="line">mv priv/static/images/phoenix.png web/static/assets/images/phoenix.png</span><br><span class="line">mv priv/static/robots.txt web/static/assets/robots.txt</span><br><span class="line">mv priv/static/js/app.js web/static/js/app.js</span><br><span class="line">mv priv/static/favicon.ico web/static/assets/favicon.ico</span><br><span class="line">touch web/static/css/app.css</span><br><span class="line">rm -rf priv/static/*</span><br></pre></td></tr></table></figure>
<h3 id="그냥-설치한-경우"><a href="#그냥-설치한-경우" class="headerlink" title="그냥 설치한 경우"></a>그냥 설치한 경우</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ mix phoenix.new with_brunch</span><br><span class="line">* creating with_brunch/config/config.exs</span><br><span class="line">* creating with_brunch/config/dev.exs</span><br><span class="line">* creating with_brunch/config/prod.exs</span><br><span class="line">* creating with_brunch/config/prod.secret.exs</span><br><span class="line">* creating with_brunch/config/test.exs</span><br><span class="line">* creating with_brunch/lib/with_brunch.ex</span><br><span class="line">* creating with_brunch/lib/with_brunch/endpoint.ex</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/views/error_view_test.exs</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/support/conn_case.ex</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/support/channel_case.ex</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/test_helper.exs</span><br><span class="line">* creating with_brunch/web/channels/user_socket.ex</span><br><span class="line">* creating with_brunch/web/router.ex</span><br><span class="line">* creating with_brunch/web/views/error_view.ex</span><br><span class="line">* creating with_brunch/web/web.ex</span><br><span class="line">* creating with_brunch/mix.exs</span><br><span class="line">* creating with_brunch/README.md</span><br><span class="line">* creating with_brunch/web/gettext.ex</span><br><span class="line">* creating with_brunch/priv/gettext/errors.pot</span><br><span class="line">* creating with_brunch/priv/gettext/en/LC_MESSAGES/errors.po</span><br><span class="line">* creating with_brunch/web/views/error_helpers.ex</span><br><span class="line">* creating with_brunch/lib/with_brunch/repo.ex</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/support/model_case.ex</span><br><span class="line">* creating with_brunch/priv/repo/seeds.exs</span><br><span class="line">* creating with_brunch/.gitignore</span><br><span class="line">* creating with_brunch/brunch-config.js</span><br><span class="line">* creating with_brunch/package.json</span><br><span class="line">* creating with_brunch/web/static/css/app.css</span><br><span class="line">* creating with_brunch/web/static/css/phoenix.css</span><br><span class="line">* creating with_brunch/web/static/js/app.js</span><br><span class="line">* creating with_brunch/web/static/js/socket.js</span><br><span class="line">* creating with_brunch/web/static/assets/robots.txt</span><br><span class="line">* creating with_brunch/web/static/assets/images/phoenix.png</span><br><span class="line">* creating with_brunch/web/static/assets/favicon.ico</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/controllers/page_controller_test.exs</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/views/layout_view_test.exs</span><br><span class="line">* creating with_brunch/<span class="built_in">test</span>/views/page_view_test.exs</span><br><span class="line">* creating with_brunch/web/controllers/page_controller.ex</span><br><span class="line">* creating with_brunch/web/templates/layout/app.html.eex</span><br><span class="line">* creating with_brunch/web/templates/page/index.html.eex</span><br><span class="line">* creating with_brunch/web/views/layout_view.ex</span><br><span class="line">* creating with_brunch/web/views/page_view.ex</span><br></pre></td></tr></table></figure>
<p>일단 필요없는 파일을 지운다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm brunch-config.js package.json</span><br><span class="line">rm web/static/css/phoenix.css web/static/js/socket.js</span><br></pre></td></tr></table></figure>
<h3 id="npm-webpack-설정"><a href="#npm-webpack-설정" class="headerlink" title="npm, webpack 설정"></a>npm, webpack 설정</h3><p>다음 명령을 실행하고 적당히 내용 입력하면 package.json 파일이 만들어진다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
<p>webpack을 설치하고 설정 파일을 만든다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack babel-preset-es2015 copy-webpack-plugin \</span><br><span class="line">                       babel-loader babel-core \</span><br><span class="line">                       css-loader extract-text-webpack-plugin style-loader</span><br></pre></td></tr></table></figure>
<p>webpack.config.js파일은 이런 내용이 들어가면 된다.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>)</span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">"copy-webpack-plugin"</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  entry: [<span class="string">"./web/static/css/app.css"</span>,</span><br><span class="line">          <span class="string">"./web/static/js/app.js"</span>],</span><br><span class="line">  output: &#123;</span><br><span class="line">    path: <span class="string">"./priv/static"</span>,</span><br><span class="line">    filename: <span class="string">"js/app.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    loaders: [&#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      include: __dirname,</span><br><span class="line">      loader: [<span class="string">"babel"</span>],</span><br><span class="line">      query: &#123;</span><br><span class="line">        presets: [<span class="string">"es2015"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">      loader: ExtractTextPlugin.extract(<span class="string">"style"</span>, <span class="string">"css"</span>)</span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> ExtractTextPlugin(<span class="string">"css/app.css"</span>),</span><br><span class="line">    <span class="keyword">new</span> CopyWebpackPlugin([&#123; <span class="attr">from</span>: <span class="string">"./web/static/assets"</span> &#125;])</span><br><span class="line">  ],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    modulesDirectories: [ <span class="string">"node_modules"</span>, __dirname + <span class="string">"/web/static/js"</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>일단 정적파일의 복사, js, css의 생성까지만 다루는 단순한 설정이다.</p>
<p>package.json에 실행 옵션을 포함한 단축명령을 적는다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">  "start": "webpack --watch-stdin --progress --color",</span><br><span class="line">  "compile": "webpack -p"</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>방금 생성한 명령을 watcher에 추가해 파일 수정이 있을때마다 실행 시킬 수 있다.</p>
<p>config/dev.exs에 넣어두자</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">config <span class="symbol">:app_name</span>, AppName.Endpoint,</span><br><span class="line">  <span class="comment"># 다른 설정은 그대로 둘것</span></span><br><span class="line">  <span class="symbol">watchers:</span> [<span class="symbol">npm:</span> [<span class="string">"start"</span>]]</span><br></pre></td></tr></table></figure>
<h2 id="phoenix-자바스크립트들"><a href="#phoenix-자바스크립트들" class="headerlink" title="phoenix 자바스크립트들"></a>phoenix 자바스크립트들</h2><p>npm에 등록되어있으니 그냥 설치하면된다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install file:deps/phoenix_html file:deps/phoenix --save</span><br></pre></td></tr></table></figure>
<p>위에 패스도 잡아뒀으니, 이전처럼 import해서 사용할 수 있다.</p>
<h1 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h1><p><a href="http://matthewlehner.net/using-webpack-with-phoenix-and-elixir/" target="_blank" rel="noopener">http://matthewlehner.net/using-webpack-with-phoenix-and-elixir/</a>
<a href="http://mikker.github.io/2016/02/04/updated-phoenix-webpack-react-setup.html" target="_blank" rel="noopener">http://mikker.github.io/2016/02/04/updated-phoenix-webpack-react-setup.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 marocchino
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>