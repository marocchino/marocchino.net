<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>BitWarden(rs)를 라즈베리파이에 설치하기 | A study note</title>

  
  <meta name="author" content="marocchino">
  

  
  <meta name="description" content="과정
subdomain ipv6으로 설정
젤 오래걸리니 젤 먼저하는 걸 추천 v4는 A고 v6는 AAAA인것만 기억하면 어려울것 없다.
주소는 ifconfig로 확인가능. (아마 없을테니까 apt로 깔자)
Docker
1234sudo apt install docker ">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="BitWarden(rs)를 라즈베리파이에 설치하기"/>

  <meta property="og:site_name" content="A study note"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="A study note" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">A study note</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>BitWarden(rs)를 라즈베리파이에 설치하기</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/04/17/install-bitwarden-to-rpi/" rel="bookmark">
        <time class="entry-date published" datetime="2021-04-17T03:25:40.000Z">
          2021-04-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h1>과정</h1>
<h2 id="subdomain-ipv6으로-설정">subdomain ipv6으로 설정</h2>
<p>젤 오래걸리니 젤 먼저하는 걸 추천 v4는 A고 v6는 AAAA인것만 기억하면 어려울것 없다.<br>
주소는 ifconfig로 확인가능. (아마 없을테니까 apt로 깔자)</p>
<h2 id="Docker">Docker</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install docker docker-compose</span><br><span class="line">sudo adduser bitwarden</span><br><span class="line">sudo groupadd docker</span><br><span class="line">sudo usermod -aG docker bitwarden</span><br></pre></td></tr></table></figure>
<h2 id="Let’s-Encrypt">Let’s Encrypt</h2>
<p>난 여기서 파일 권한 문제로 삽질 많이했는데 그냥 bitwarden계정으로 도커를<br>
실행하면 알아서 퍼미션 잡힐테니 그냥 이렇게 하면 된다.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo su - bitwarden</span><br><span class="line">docker run -it --rm --name certbot \</span><br><span class="line">  -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">  -v <span class="string">&quot;/var/lib/letsencrypt:/var/lib/letsencrypt&quot;</span> \</span><br><span class="line">  certbot/certbot:arm64v8-latest certonly \</span><br><span class="line">  --standalone -d <span class="variable">$YOUR_DOMAIN_HERE</span> -m <span class="variable">$YOUR_EMAIL_HERE</span> --agree-tos</span><br></pre></td></tr></table></figure>
<h2 id="서버-띄우기">서버 띄우기</h2>
<p><code>start.sh</code>파일을 만들어두자.<br>
로그볼일이 있을까 싶어서 일부러 <code>--rm</code>옵션은 주지 않았다.<br>
ROCKET_ADDRESS는 디폴트가 0.0.0.0이라 그대로두면 IPv4에서 밖에 인식 못하니 주의</p>
<!-- markdownlint-disable MD013 -->
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">yes | docker container prune <span class="comment"># prune이 싫으면 docker rm bitwarden 해도 된다</span></span><br><span class="line">docker run -d --name bitwarden \</span><br><span class="line">  -e ROCKET_TLS=<span class="string">&quot;&#123;certs=\&quot;/letsencrypt/live/<span class="variable">$YOUR_DOMAIN_HERE</span>/fullchain.pem\&quot;,key=\&quot;/letsencrypt/live/<span class="variable">$YOUR_DOMAIN_HERE</span>/privkey.pem\&quot;&#125;&quot;</span> \</span><br><span class="line">  -e ROCKET_ADDRESS=<span class="string">&#x27;::&#x27;</span> \</span><br><span class="line">  -e ADMIN_TOKEN=<span class="string">&quot;<span class="variable">$ADMON_TOKEN</span>&quot;</span> \</span><br><span class="line">  --hostname your.servername.here \</span><br><span class="line">  -v /etc/letsencrypt/:/letsencrypt/ \</span><br><span class="line">  -v /home/bitwarden/bwdata/:/data/ \</span><br><span class="line">  -p 443:80 \</span><br><span class="line">  vaultwarden/server:latest</span><br></pre></td></tr></table></figure>
<!-- markdownlint-enable MD013 -->
<h2 id="인증서-자동-갱신">인증서 자동 갱신</h2>
<p><code>renew.sh</code>파일도 만들자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">yes | docker container prune</span><br><span class="line">docker run -it --name certbot \</span><br><span class="line">  -v <span class="string">&quot;/etc/letsencrypt:/etc/letsencrypt&quot;</span> \</span><br><span class="line">  -v <span class="string">&quot;/var/lib/letsencrypt:/var/lib/letsencrypt&quot;</span> \</span><br><span class="line">  certbot/certbot:arm64v8-latest renew</span><br></pre></td></tr></table></figure>
<p>매월 15일에 갱신하고 내친김에 리붓했을때 서버 자동으로 켜게 해두자.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crontab -u bitwarden -e</span><br><span class="line">00 04 15 * * /home/bitwarden/renew.sh</span><br><span class="line">@reboot /home/bitwarden/start.sh</span><br></pre></td></tr></table></figure>
<h2 id="IPv6-IP-고정">IPv6 IP 고정</h2>
<p>라즈비안에서는 그런 일없었는데 리붓할때 마다 아이피가 바뀐다.</p>
<p>Network -&gt; Wired -&gt; Config -&gt; IPv6가서 다음 과 같이 설정한다.<br>
v6 IP는 대충 <code>2409:10:12:34:56:78:90:12</code>라고 가정해보자.</p>
<p>Method: Manual<br>
Address: 2409:10:12:34:56:78:90:12<br>
Prefix: 2409:10:12:34::/64<br>
Gateway: 2409:10:12:34::1</p>
<p>리붓하면 아이피가 고정된다.</p>
<h2 id="Todo">Todo</h2>
<p>갱신이 7월 16일이니 그때 갱신 됐는지 확인하면 될듯.</p>
<h2 id="이력">이력</h2>
<ul>
<li>2021.05.22 IP 고정항목 추가, bitwardenrs -&gt; vaultwarden, ROCKET_ADDRESS 추가</li>
</ul>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    

    </div>

    
  </div>
</article>

  






    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 marocchino
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>